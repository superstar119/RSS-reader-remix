generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_PRISMA_URL")
}

model User {
  id                String @id @default(cuid()) 
  email             String @unique
  password          String
  feedSubscription  FeedSubscription[]
  read              Read[]

  @@index([id], name: "user_index", type: Hash)
}

model FeedSubscription {
  id        String @id @default(cuid())
  feedId    String  
  userId    String  
  order     Int     @unique
  feed      Feed    @relation(fields: [feedId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@unique([userId, feedId, order])
  
  @@index([feedId, userId], name: "feedId_userId_index", type: Hash)
  @@index([feedId], name: "feedId_index", type: Hash)
  @@index([userId], name: "userId_index", type: Hash)
  @@index([id], name: "feedSubscription_index", type: Hash)
}

model Feed {
  id                String @id @default(cuid())
  url               String @unique
  title             String
  FeedPost          FeedPost[]
  feedSubscription  FeedSubscription[]

  @@index([id], name: "Feed_id_index", type: Hash)
}

model FeedPost {
  id      String   @id @default(cuid())
  title   String
  imgSrc  String
  pubDate String
  content String
  author  String
  link    String
  feedId  String
  feed    Feed     @relation(fields:[feedId], references: [id], onDelete: Cascade)
  read    Read[]

  @@index([id], name: "Post_id_index", type: Hash)
  @@index([feedId], name: "Feed_id_index", type: Hash)
}

model Read {
  id        String      @id   @default(cuid())
  userId    String
  postId    String
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  post      FeedPost    @relation(fields: [postId], references: [id], onDelete: Cascade)
    
  @@index([id], name: "Read_id_index", type: Hash)
  @@index([userId], name: "user_id_index", type: Hash)
  @@index([postId], name: "post_id_index", type: Hash)
}
